# HVAC Company Data Model Enhancement Plan

## Current State Analysis - CORRECTED

**Gap Identified**: Your Python script generates 20+ CSV files, but your dbt project only loads 6 tables!

### Current dbt Configuration (6 tables):
- `customers` ✓
- `technicians` ✓ 
- `equipment_types` ✓
- `parts` ✓
- `service_calls` ✓
- `parts_usage` ✓

### Generated but NOT loaded in dbt (14+ tables):
- `installed_devices` - Equipment tracking
- `incident_response` - Emergency management  
- `vehicle_fleet` - Asset management
- `mailing_list` - Marketing contacts
- `subscriptions` - Service contracts
- `invoices` + `payments` - Financial transactions
- `inventory` - Stock management
- `appointments` - Scheduling
- `quotes` - Sales estimates
- `work_orders` - Detailed instructions
- `customer_feedback` - Service quality
- `leads` - Sales pipeline

**Existing Core Tables:**
- `customers` (500) - Customer management
- `technicians` (15) - Staff management with skills
- `equipment_types` (50) - Product catalog
- `parts` (200) - Inventory items
- `service_calls` (2000) - Work orders
- `parts_usage` - Junction table for consumables

**Existing Extended Tables:**
- `installed_devices` (800) - Equipment tracking
- `subscriptions` (250) - Service contracts ✓ (Already have sales contracts)
- `quotes` (400) - Sales estimates ✓ (Already have sales pipeline)
- `invoices` + `payments` - Financial transactions ✓ (Already have finance basics)
- `leads` (600) - Sales pipeline ✓ (Already have marketing leads)
- `mailing_list` (800) - Marketing contacts ✓ (Already have marketing)
- `appointments` (500) - Scheduling
- `work_orders` - Detailed instructions
- `customer_feedback` (800) - Service quality
- `inventory` - Stock management
- `incident_response` (150) - Emergency management
- `vehicle_fleet` (20) - Asset management

## Two-Phase Enhancement Plan

### **PHASE 1: Enable Existing Generated Data (Priority 1)**
First, add dbt seed configurations for the 14 tables already generated by your Python script:

#### Immediate Business Value Tables:
1. **invoices** + **payments** - Critical for financial tracking
2. **appointments** - Essential for scheduling operations  
3. **quotes** - Sales pipeline management
4. **leads** - Customer acquisition tracking
5. **subscriptions** - Recurring revenue management

#### Supporting Operations Tables:
6. **installed_devices** - Equipment warranty/service tracking
7. **inventory** - Parts stock management
8. **work_orders** - Detailed service instructions
9. **customer_feedback** - Service quality metrics
10. **incident_response** - Emergency response tracking
11. **vehicle_fleet** - Asset management
12. **mailing_list** - Marketing contacts

### **PHASE 2: Additional Business Tables (New Development)**

### 1. Sales & Revenue Management (New Tables)

#### **sales_opportunities**
Enhanced sales pipeline beyond basic quotes
- `opportunity_id`, `lead_id`, `customer_id`, `opportunity_value`
- `probability`, `stage`, `expected_close_date`, `sales_rep_id`
- `competitor`, `decision_maker`, `pain_points`
- Links: `leads` → `sales_opportunities` → `quotes` → `invoices`

#### **sales_commissions**
Track sales performance and compensation
- `commission_id`, `sales_rep_id`, `invoice_id`, `commission_rate`
- `commission_amount`, `payment_date`, `commission_type`
- Links: `invoices` → `sales_commissions` ← `employees`

### 2. Human Resources (New Department)

#### **employees**
Comprehensive staff management (extends technicians)
- `employee_id`, `employee_number`, `department`, `job_title`
- `hire_date`, `salary`, `employment_status`, `supervisor_id`
- `emergency_contact`, `benefits_enrolled`, `performance_rating`
- Links: Replaces/extends `technicians` table

#### **time_tracking**
Employee time and attendance
- `time_entry_id`, `employee_id`, `service_call_id`, `date`
- `clock_in_time`, `clock_out_time`, `break_duration`
- `overtime_hours`, `time_type` (regular/overtime/holiday)
- Links: `employees` ← `time_tracking` → `service_calls`

#### **training_certifications**
Professional development tracking
- `certification_id`, `employee_id`, `certification_name`
- `certification_body`, `issue_date`, `expiry_date`, `renewal_required`
- Links: `employees` ← `training_certifications`

### 3. Advanced Financial Management

#### **expense_reports**
Business expense tracking
- `expense_id`, `employee_id`, `vehicle_id`, `expense_date`
- `category`, `amount`, `receipt_url`, `approval_status`
- `mileage`, `fuel_cost`, `business_purpose`
- Links: `employees` ← `expense_reports` → `vehicle_fleet`

#### **budget_planning**
Financial planning and forecasting
- `budget_id`, `department`, `budget_year`, `category`
- `budgeted_amount`, `actual_amount`, `variance`
- `quarter`, `approval_status`, `notes`

#### **tax_reporting**
Tax compliance and reporting
- `tax_record_id`, `invoice_id`, `tax_jurisdiction`
- `tax_type`, `tax_rate`, `tax_amount`, `filing_period`
- Links: `invoices` → `tax_reporting`

### 4. Enhanced Marketing & Customer Acquisition

#### **marketing_campaigns**
Campaign management and ROI tracking
- `campaign_id`, `campaign_name`, `campaign_type`, `start_date`
- `end_date`, `budget`, `actual_spend`, `target_audience`
- `lead_source`, `conversion_rate`, `roi`
- Links: `marketing_campaigns` → `leads` (via lead_source)

#### **customer_communications**
Communication history tracking
- `communication_id`, `customer_id`, `communication_type`
- `direction`, `subject`, `content`, `timestamp`
- `employee_id`, `outcome`, `follow_up_required`
- Links: `customers` ← `customer_communications` → `employees`

#### **referral_program**
Customer referral tracking
- `referral_id`, `referring_customer_id`, `referred_customer_id`
- `referral_date`, `referral_status`, `reward_amount`
- `reward_paid_date`, `referral_source`
- Links: `customers` (referring) → `referral_program` ← `customers` (referred)

### 5. Operations & Compliance

#### **safety_incidents**
Workplace safety tracking
- `incident_id`, `employee_id`, `incident_date`, `location`
- `injury_type`, `severity`, `description`, `witnesses`
- `investigation_status`, `corrective_actions`, `osha_reportable`
- Links: `employees` ← `safety_incidents`

#### **compliance_audits**
Regulatory compliance management
- `audit_id`, `audit_type`, `audit_date`, `auditor`
- `compliance_score`, `violations_found`, `corrective_actions`
- `next_audit_date`, `certification_status`

#### **warranty_claims**
Equipment warranty management
- `warranty_claim_id`, `installed_device_id`, `claim_date`
- `claim_type`, `claim_amount`, `manufacturer_response`
- `claim_status`, `resolution_date`, `parts_replaced`
- Links: `installed_devices` → `warranty_claims`

### 6. Enhanced Customer Experience

#### **service_territories**
Geographic service area management
- `territory_id`, `territory_name`, `zip_codes`
- `assigned_technician_id`, `service_level`, `travel_time`
- Links: `technicians` ← `service_territories` → `customers` (by zip)

#### **customer_contracts**
Advanced contract management (beyond subscriptions)
- `contract_id`, `customer_id`, `contract_type`, `start_date`
- `end_date`, `terms`, `sla_response_time`, `penalty_clauses`
- `auto_renewal`, `escalation_clauses`, `performance_metrics`
- Links: `customers` ← `customer_contracts`

## Implementation Priority

### Phase 1 (High Impact)
1. **employees** - Core HR foundation
2. **sales_opportunities** - Enhanced sales tracking
3. **time_tracking** - Operational efficiency
4. **expense_reports** - Cost management

### Phase 2 (Medium Impact)
1. **marketing_campaigns** - ROI measurement
2. **warranty_claims** - Service efficiency
3. **customer_communications** - Service quality
4. **safety_incidents** - Compliance

### Phase 3 (Long-term Value)
1. **training_certifications** - Professional development
2. **service_territories** - Geographic optimization
3. **referral_program** - Customer acquisition
4. **compliance_audits** - Risk management

## Data Volume Recommendations

To maintain your <$7 Snowflake budget:
- **employees**: 25 records (includes current technicians + office staff)
- **sales_opportunities**: 300 records
- **time_tracking**: 1000 records (daily entries for 30 days)
- **expense_reports**: 200 records
- **marketing_campaigns**: 20 campaigns
- **customer_communications**: 1500 records
- **warranty_claims**: 150 records

**Total Additional Records**: ~3,200 across 7-8 new tables (estimated additional cost: $1-2)

## Key Business Relationships

```
customers → sales_opportunities → quotes → invoices → payments
    ↓                                          ↓
customer_contracts                         tax_reporting
    ↓
service_calls → time_tracking → employees → expense_reports
    ↓               ↓
warranty_claims    training_certifications

leads ← marketing_campaigns
leads → sales_opportunities

customers ← referral_program → customers
customers ← customer_communications → employees
```

## Missing Tables Still Identified

1. **Asset depreciation** tracking for vehicles/equipment
2. **Insurance claims** management
3. **Vendor/supplier** management beyond basic supplier names
4. **Job costing** analysis for profitability by service type
5. **Performance metrics** dashboard data
6. **Seasonal pricing** adjustments
7. **Multi-location** management (if company has multiple offices)

Would you like me to proceed with implementing any of these tables, or would you prefer to focus on specific business areas first?